# Pre-commit validation - ensures ALL committed code meets quality standards
# This is the ONLY gate before code enters git history
echo "ğŸ” Running pre-commit validation..."

# 1. TypeScript type checking on ENTIRE codebase (not just staged files)
#    This ensures we don't commit code that breaks the overall type system
echo "ğŸ“˜ Checking TypeScript types..."
pnpm exec tsc --noEmit || {
  echo "âŒ TypeScript type check failed! Please fix type errors before committing."
  exit 1
}

# 2. Run ESLint with auto-fix on staged files
#    This catches code quality issues and auto-fixes when possible
echo "ğŸ§¹ Running linter on staged files..."
pnpx lint-staged || {
  echo "âŒ Linting failed! Please fix linting errors before committing."
  exit 1
}

# 3. Verify build works (ensures code compiles)
echo "ğŸ”¨ Verifying build..."
pnpm build || {
  echo "âŒ Build failed! Please fix build errors before committing."
  exit 1
}

# 4. Run unit tests (ensures functionality works)
echo "ğŸ§ª Running unit tests..."
pnpm test:unit || {
  echo "âŒ Unit tests failed! Please fix failing tests before committing."
  exit 1
}

echo "âœ… All pre-commit checks passed! Safe to commit."
